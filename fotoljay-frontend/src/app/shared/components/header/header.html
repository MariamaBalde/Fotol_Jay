<header class="header">
  <div class="container header-content">
    <!-- Logo -->
    <div class="logo" (click)="naviguerVers('/produits')">
      <span class="logo-icon">📱</span>
      <span class="logo-text">FreshMarket</span>
    </div>

    <!-- Barre de recherche (desktop) -->
    <div class="search-bar hide-mobile">
      <input
        type="text"
        [(ngModel)]="termesRecherche"
        (keyup.enter)="rechercher()"
        placeholder="Rechercher un produit..."
        class="search-input"
      />
      <button class="search-btn" (click)="rechercher()">🔍</button>
    </div>

    <!-- Actions -->
    <div class="header-actions">
      <!-- Recherche mobile -->
      <button class="icon-btn hide-desktop" (click)="toggleRecherche()">🔍</button>

      <!-- Publier (si connecté) -->
      <button
        *ngIf="authService.estConnecte()"
        class="btn-publier"
        (click)="naviguerVers('/produits/creer')"
      >
        <span class="hide-mobile">➕ Publier</span>
        <span class="hide-desktop">➕</span>
      </button>

      <!-- Menu utilisateur -->
      <div class="user-menu" *ngIf="utilisateur$ | async as utilisateur; else authButtons">
        <button class="user-avatar" (click)="toggleMenu()">
          <span *ngIf="!utilisateur.photoProfil" class="avatar-placeholder">
            {{ utilisateur.prenom.charAt(0) }}{{ utilisateur.nom.charAt(0) }}
          </span>
          <img
            *ngIf="utilisateur.photoProfil"
            [src]="utilisateur.photoProfil"
            [alt]="utilisateur.prenom"
          />
          <span class="vip-badge" *ngIf="authService.estVIP()">⭐</span>
        </button>

        <!-- Dropdown menu -->
        <div class="dropdown-menu" *ngIf="menuOuvert">
          <div class="dropdown-header">
            <div class="user-info">
              <p class="user-name">{{ utilisateur.prenom }} {{ utilisateur.nom }}</p>
              <p class="user-email">{{ utilisateur.email }}</p>
            </div>
          </div>

          <div class="dropdown-divider"></div>

          <button class="dropdown-item" (click)="naviguerVers('/produits/mes-produits')">
            📦 Mes annonces
          </button>

          <button class="dropdown-item" (click)="naviguerVers('/profil')">
            👤 Mon profil
          </button>

          <button
            *ngIf="!authService.estVIP()"
            class="dropdown-item vip-item"
            (click)="naviguerVers('/profil/vip')"
          >
            ⭐ Devenir VIP
          </button>

          <button
            *ngIf="authService.estModerateur()"
            class="dropdown-item"
            (click)="naviguerVers('/moderation')"
          >
            ⚖️ Modération
          </button>

          <div class="dropdown-divider"></div>

          <button class="dropdown-item logout-item" (click)="deconnecter()">
            🚪 Déconnexion
          </button>
        </div>
      </div>

      <!-- Boutons auth (si non connecté) -->
      <ng-template #authButtons>
        <button class="btn-outline" (click)="naviguerVers('/auth/login')">
          Connexion
        </button>
        <button class="btn-primary hide-mobile" (click)="naviguerVers('/auth/register')">
          S'inscrire
        </button>
      </ng-template>
    </div>
  </div>

  <!-- Barre de recherche mobile -->
  <div class="search-mobile" *ngIf="rechercheOuverte">
    <input
      type="text"
      [(ngModel)]="termesRecherche"
      (keyup.enter)="rechercher()"
      placeholder="Rechercher..."
      class="search-input-mobile"
      autofocus
    />
    <button class="search-btn-mobile" (click)="rechercher()">🔍</button>
    <button class="close-btn-mobile" (click)="toggleRecherche()">✕</button>
  </div>
</header>

<!-- Overlay pour fermer le menu -->
<div class="overlay" *ngIf="menuOuvert" (click)="toggleMenu()"></div>
